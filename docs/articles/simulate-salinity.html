<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An advection and first-order exchange model of channel salinity • deltasalinity</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="An advection and first-order exchange model of channel salinity">
<meta property="og:description" content="deltasalinity">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">deltasalinity</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/salinity-sea-level-rise.html">Salinity and sea level rise</a>
    </li>
    <li>
      <a href="../articles/simulate-salinity.html">An advection and first-order exchange model of channel salinity</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="simulate-salinity_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>An advection and first-order exchange model of channel salinity</h1>
            
      
      
      <div class="hidden name"><code>simulate-salinity.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">deltasalinity</span><span class="op">)</span></code></pre></div>
<div id="the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#the-model" class="anchor"></a>The model</h2>
<p>The salinity model is written as the time derivative of salinity concentration, <span class="math inline">\(C\)</span> [ppm]:</p>
<p><span class="math display">\[\frac{dC}{dt}=-aQ_H (C-C_U)+be^{-dQ_H}(C_D-C)\]</span> where <span class="math inline">\(C_U\)</span> is (small) upstream salinity, <span class="math inline">\(C_D\)</span> = 35 ppt is downstream (ocean) salinity and parameters <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, and <span class="math inline">\(d\)</span> are calibration constants, and <span class="math inline">\(Q_H\)</span> is upstream flow, in this case flow at Hardinge Bridge. The two terms on the right-hand side of the equation represent advection and first order exchange, respectively. The exchange term <span class="math inline">\(be^{-dQ_H}\)</span> decreases (or increases) with higher (or lower) streamflow as the channel becomes dominated by inflow (or tidal oscillations). Please note that this model assumes well mixed channels within the delta. Of course this is not a realistic assumption and there will likely be nonlinear salinity gradients moving downstream. The nonlinearity of the model may account for this when appropriately calibrated, but make sure to test the model to ensure it sufficiently approximates salinity at the location(s) of interest.</p>
</div>
<div id="the-salinity-modeling-function" class="section level2">
<h2 class="hasAnchor">
<a href="#the-salinity-modeling-function" class="anchor"></a>The salinity modeling function</h2>
<p>The salinity model is contained within the function <code>sim_salin</code>, which requires the following paramers:</p>
<ul>
<li>
<code>Q_ts</code>: Daily streamflow timeseries</li>
<li>
<code>v</code>: The log of parameter variables for the model in a vector: <code>v = c(log(a), log(b), log(d), log(C_d))</code>. Note that they are written as log values for convenience in calibration (which ensures they are positive). The parameters are therefore calculated as
<ul>
<li><code>a = exp(v[1])</code></li>
<li><code>b = exp(v[2])</code></li>
<li><code>d = exp(v[3])</code></li>
<li><code>C_d = exp(v[4])</code></li>
</ul>
</li>
<li>
<code>salin_min</code>: Minimum channel salinity</li>
</ul>
<p>The function is called for a single timeseries as: <code><a href="../reference/sim_salin.html">sim_salin(Q_ts,v,salin_min=100)</a></code>.</p>
</div>
<div id="simulating-salinity-over-multiple-years" class="section level2">
<h2 class="hasAnchor">
<a href="#simulating-salinity-over-multiple-years" class="anchor"></a>Simulating salinity over multiple years</h2>
<p>The <code>sim_salin</code> function is fairly straightforward, but in practice it can be tricky to implement. Thi spackage also includes a wrapper function <code>sim_salin_annual</code> which runs <code>sim_salin</code> for each year. The <code>sim_salin_annual</code> function simulates each year separately, so that <span class="math inline">\(C\)</span> is always initialized as 100 ppm on January 1.</p>
</div>
<div id="running-the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#running-the-model" class="anchor"></a>Running the model</h2>
<p>The following built in data contain streamflow timeseries and calibrated parameters:</p>
<ul>
<li>
<code>ganges_salinity</code> includes mean daily streamflow at Hardinge bridge since the treaty was signed, as well as synthetic salinity in 2006, generated under the counterfactual scenario that the treaty had not been signed (see <a href="https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/2019WR026166">Penny et al., 2020</a>)</li>
<li>
<code>ganges_params</code> contains parameters for the model, calibrated to observed salinity at Khulna station in the Ganges delta for available data since 1990 (again, see <a href="https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/2019WR026166">Penny et al., 2020</a>).</li>
</ul>
<p>Below, these data are loaded and used to simulate salinity.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load libraries: the functions require dplyr, tidyr, and deSolve. read_csv requires readr</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span> <span class="co"># loads dplyr, tidyr, and readr</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://desolve.r-forge.r-project.org/">deSolve</a></span><span class="op">)</span>

<span class="co"># Load the data</span>
<span class="va">v</span> <span class="op">&lt;-</span> <span class="va">ganges_params</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span>
<span class="co">#&gt;        var      param</span>
<span class="co">#&gt; 1   log(a) -12.560625</span>
<span class="co">#&gt; 2   log(b)  -4.207450</span>
<span class="co">#&gt; 3   log(d)  -6.187243</span>
<span class="co">#&gt; 4 log(C_d)  10.463103</span>

<span class="va">streamflow_df</span> <span class="op">&lt;-</span> <span class="va">ganges_streamflow</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">streamflow_df</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 362 x 5</span>
<span class="co">#&gt;     year date        yday Q_cumec group     </span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;date&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     </span>
<span class="co">#&gt;  1     1 1998-01-01     1   2970. Treaty avg</span>
<span class="co">#&gt;  2     1 1998-01-02     2   2930. Treaty avg</span>
<span class="co">#&gt;  3     1 1998-01-03     3   2891. Treaty avg</span>
<span class="co">#&gt;  4     1 1998-01-04     4   2874. Treaty avg</span>
<span class="co">#&gt;  5     1 1998-01-05     5   2799. Treaty avg</span>
<span class="co">#&gt;  6     1 1998-01-06     6   2752. Treaty avg</span>
<span class="co">#&gt;  7     1 1998-01-07     7   2737. Treaty avg</span>
<span class="co">#&gt;  8     1 1998-01-08     8   2688. Treaty avg</span>
<span class="co">#&gt;  9     1 1998-01-09     9   2626. Treaty avg</span>
<span class="co">#&gt; 10     1 1998-01-10    10   2563. Treaty avg</span>
<span class="co">#&gt; # … with 352 more rows</span>

<span class="co"># Simulate salinity annually</span>
<span class="va">salinity_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_salin_annual.html">sim_salin_annual</a></span><span class="op">(</span><span class="va">streamflow_df</span>, <span class="va">v</span><span class="op">$</span><span class="va">param</span><span class="op">)</span></code></pre></div>
<p>The tabulated results are (<code><a href="https://rdrr.io/r/base/print.html">print(results)</a></code>):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">salinity_results</span>
<span class="co">#&gt; # A tibble: 362 x 3</span>
<span class="co">#&gt;    date       Q_cumec S_ppm</span>
<span class="co">#&gt;    &lt;date&gt;       &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt;  1 1998-01-01   2970.  100 </span>
<span class="co">#&gt;  2 1998-01-02   2930.  100.</span>
<span class="co">#&gt;  3 1998-01-03   2891.  101.</span>
<span class="co">#&gt;  4 1998-01-04   2874.  101.</span>
<span class="co">#&gt;  5 1998-01-05   2799.  102.</span>
<span class="co">#&gt;  6 1998-01-06   2752.  102.</span>
<span class="co">#&gt;  7 1998-01-07   2737.  103.</span>
<span class="co">#&gt;  8 1998-01-08   2688.  104.</span>
<span class="co">#&gt;  9 1998-01-09   2626.  106.</span>
<span class="co">#&gt; 10 1998-01-10   2563.  107.</span>
<span class="co">#&gt; # … with 352 more rows</span></code></pre></div>
<p>The results plotted:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Combine results with streamflow data frame for plotting</span>
<span class="va">results_df</span> <span class="op">&lt;-</span> <span class="va">streamflow_df</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">salinity_results</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"date"</span>,<span class="st">"S_ppm"</span><span class="op">)</span><span class="op">]</span>,by <span class="op">=</span> <span class="st">"date"</span><span class="op">)</span>

<span class="co"># Plot the results</span>
<span class="va">p_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">results_df</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">var</span>,<span class="va">val</span>,<span class="va">Q_cumec</span>,<span class="va">S_ppm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">yday</span>,<span class="va">val</span>, color <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">var</span>,ncol<span class="op">=</span><span class="fl">1</span>,scales<span class="op">=</span><span class="st">"free"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">0.9</span><span class="op">)</span>,legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p_results</span><span class="op">)</span></code></pre></div>
<p><img src="simulate-salinity_files/figure-html/unnamed-chunk-3-1.png" width="576"></p>
</div>
<div id="model-calibration" class="section level2">
<h2 class="hasAnchor">
<a href="#model-calibration" class="anchor"></a>Model calibration</h2>
<p>The model can also be calibrated using functions in this package. See <code><a href="../reference/calibrate_salinity_model.html">?calibrate_salinity_model</a></code> for more details.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Gopal Penny.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
